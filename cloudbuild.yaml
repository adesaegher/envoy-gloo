steps:
- name: 'envoyproxy/envoy-build:a734887ad06609cf0b3c023d38239bf3e79d3717'
  args: ['ci/do_ci.sh', 'test']
  volumes:
  - name: 'vol-build'
    path: '/build'
  env:
  - 'COMMIT_SHA=$COMMIT_SHA'
  timeout: 900s

- name: 'envoyproxy/envoy-build:a734887ad06609cf0b3c023d38239bf3e79d3717'
  args: ['ci/do_ci.sh', 'build']
  volumes:
  - name: 'vol-build'
    path: '/build'
  env:
  - 'COMMIT_SHA=$COMMIT_SHA'
  timeout: 900s

options:
  machineType: 'N1_HIGHCPU_32'
timeout: 1800s

artifacts:
  objects:
    location: 'gs://solo-public-artifacts.solo.io/envoy/$COMMIT_SHA/'
    paths: ['ci/envoy.stripped', 'ci/envoy', 'ci/envoy.debuginfo']
